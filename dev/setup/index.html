<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Setup · PSPipe Planck</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/so.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">PSPipe Planck</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Setup</a><ul class="internal"><li><a class="tocitem" href="#Configuration"><span>Configuration</span></a></li><li class="toplevel"><a class="tocitem" href="#Downloading-the-Planck-2018-Data"><span>Downloading the Planck 2018 Data</span></a></li></ul></li><li><a class="tocitem" href="../rawspectra/">Raw Spectra</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Setup</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Setup</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/simonsobs/PSpipe/tree/planckcov/project/Planck_cov/docs/lit/setup.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Setup-(setup.jl)"><a class="docs-heading-anchor" href="#Setup-(setup.jl)">Setup (setup.jl)</a><a id="Setup-(setup.jl)-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-(setup.jl)" title="Permalink"></a></h1><p>This pipeline is written in Julia, so you will need a <a href="https://julialang.org/">Julia</a> installation in order to run the components. We recommend you use the precompiled binaries provided on the Julia website. Make sure to add the Julia executable to your path, as described in the <a href="https://julialang.org/downloads/platform/">platform-specific instructions.</a></p><p>The command-line interface for this basic pipeline setup script is</p><pre class="shell">
<code class="language-shell hljs">$ julia setup.jl global.toml</code></pre><ul><li>It displays the contents of the global TOML configuration file named <em>global.toml</em>.</li><li>This script downloads the Planck data to the specified directories in <em>global.toml</em>.</li></ul><h2 id="Configuration"><a class="docs-heading-anchor" href="#Configuration">Configuration</a><a id="Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration" title="Permalink"></a></h2><p>All of the pipeline scripts take a configuration TOML file as the first argument. We now print out just the <code>[dir]</code> entry in the TOML, which is what you will need to configure.</p><pre><code class="language-julia">using TOML
configfile = ARGS[1]  # read in the first command line argument
println(&quot;config filename: &quot;, configfile, &quot;\n&quot;)

# take a look at the config
config = TOML.parsefile(configfile)
TOML.print(Dict(&quot;dir&quot;=&gt;config[&quot;dir&quot;]))  # print just the &quot;dir&quot; TOML entry</code></pre><pre class="documenter-example-output">config filename: example.toml

[dir]
mask = &quot;/tmp/planck256/masks&quot;
map = &quot;/tmp/planck256/maps&quot;
beam = &quot;/tmp/planck256/beams&quot;
scratch = &quot;/tmp/planck256&quot;</pre><ul><li>The <code>scratch</code> space is where intermediary files are deposited.</li><li>Note that each map file has an identifier. This shortens the long names, but more importantly allows one to set up a custom system of names when we cross-correlate Planck with other experiments.</li><li>In this case, we preface all Planck maps and masks with <code>P</code>, and include the frequency and split.</li></ul><h1 id="Downloading-the-Planck-2018-Data"><a class="docs-heading-anchor" href="#Downloading-the-Planck-2018-Data">Downloading the Planck 2018 Data</a><a id="Downloading-the-Planck-2018-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Downloading-the-Planck-2018-Data" title="Permalink"></a></h1><pre><code class="language-julia"># set up download urls
using Downloads

if length(ARGS) == 0
    TARGET_DIR = pwd()
else
    TARGET_DIR = ARGS[1]
end

# set up directories
mapdest = config[&quot;dir&quot;][&quot;map&quot;]
maskdest = config[&quot;dir&quot;][&quot;mask&quot;]
beamdest = config[&quot;dir&quot;][&quot;beam&quot;]
mkpath(mapdest)
mkpath(maskdest)
mkpath(beamdest)

function download_if_necessary(url, dest; verbose=true)
    if isfile(dest) == false
        verbose &amp;&amp; println(&quot;Downloading &quot;, dest)
        @time Downloads.download(url, dest)
    else
        verbose &amp;&amp; println(&quot;Extant, skip &quot;, dest)
    end
end</code></pre><pre class="documenter-example-output">download_if_necessary (generic function with 1 method)</pre><pre><code class="language-julia"># now read from config and then actually download
mapfiles = values(config[&quot;map&quot;])
maskfiles = [values(config[&quot;maskT&quot;])..., values(config[&quot;maskP&quot;])...]

for f in mapfiles
    download_if_necessary(joinpath(config[&quot;url&quot;][&quot;maps&quot;], f), joinpath(mapdest, f))
end

for f in maskfiles
    download_if_necessary(joinpath(config[&quot;url&quot;][&quot;masks&quot;], f), joinpath(maskdest, f))
end

# just download beamfile to the target directory base.
beamfile = &quot;HFI_RIMO_BEAMS_R3.01.tar.gz&quot;
download_if_necessary(joinpath(config[&quot;url&quot;][&quot;beams&quot;], beamfile), joinpath(beamdest, beamfile))
run(`gzip -f -d --keep $(joinpath(beamdest, beamfile))`)
beamfiletar = replace(beamfile, &quot;.tar.gz&quot;=&gt;&quot;.tar&quot;)
run(`tar -xf $(joinpath(beamdest, beamfiletar)) --overwrite -C $(beamdest)`);</code></pre><pre class="documenter-example-output">Extant, skip /tmp/planck256/maps/nside256_HFI_SkyMap_100_2048_R3.01_halfmission-1.fits
Extant, skip /tmp/planck256/maps/nside256_HFI_SkyMap_143_2048_R3.01_halfmission-1.fits
Extant, skip /tmp/planck256/maps/nside256_HFI_SkyMap_143_2048_R3.01_halfmission-2.fits
Extant, skip /tmp/planck256/maps/nside256_HFI_SkyMap_217_2048_R3.01_halfmission-1.fits
Extant, skip /tmp/planck256/maps/nside256_HFI_SkyMap_100_2048_R3.01_halfmission-2.fits
Extant, skip /tmp/planck256/maps/nside256_HFI_SkyMap_217_2048_R3.01_halfmission-2.fits
Extant, skip /tmp/planck256/masks/nside256_COM_Mask_Likelihood-temperature-100-hm1_2048_R3.00.fits
Extant, skip /tmp/planck256/masks/nside256_COM_Mask_Likelihood-temperature-143-hm1_2048_R3.00.fits
Extant, skip /tmp/planck256/masks/nside256_COM_Mask_Likelihood-temperature-143-hm2_2048_R3.00.fits
Extant, skip /tmp/planck256/masks/nside256_COM_Mask_Likelihood-temperature-217-hm1_2048_R3.00.fits
Extant, skip /tmp/planck256/masks/nside256_COM_Mask_Likelihood-temperature-100-hm2_2048_R3.00.fits
Extant, skip /tmp/planck256/masks/nside256_COM_Mask_Likelihood-temperature-217-hm2_2048_R3.00.fits
Extant, skip /tmp/planck256/masks/nside256_COM_Mask_Likelihood-polarization-100-hm1_2048_R3.00.fits
Extant, skip /tmp/planck256/masks/nside256_COM_Mask_Likelihood-polarization-143-hm1_2048_R3.00.fits
Extant, skip /tmp/planck256/masks/nside256_COM_Mask_Likelihood-polarization-143-hm2_2048_R3.00.fits
Extant, skip /tmp/planck256/masks/nside256_COM_Mask_Likelihood-polarization-217-hm1_2048_R3.00.fits
Extant, skip /tmp/planck256/masks/nside256_COM_Mask_Likelihood-polarization-100-hm2_2048_R3.00.fits
Extant, skip /tmp/planck256/masks/nside256_COM_Mask_Likelihood-polarization-217-hm2_2048_R3.00.fits
Extant, skip /tmp/planck256/beams/HFI_RIMO_BEAMS_R3.01.tar.gz</pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a><a class="docs-footer-nextpage" href="../rawspectra/">Raw Spectra »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 19 April 2021 02:51">Monday 19 April 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
